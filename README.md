このプロジェクトは、[LightFile Lambda関数](https://www.ideamans.com/lightfile/lambda/)の補助ツール群です。

次のツールを提供します。

* S3バケットの既存オブジェクトの軽量化
  * スクリプトのみで既存のオブジェクトを軽量化
  * S3バッチオペレーションのために既存のオブジェクトのCSVファイルを作成

# 設定

`.env-example`を`.env`ファイルとして複製し、内容を変更してください。

* `BUCKET`と`LAMBDA`はお使いのS3バケットとLambda関数名に合わせて必ず変更してください。
* 特定のフォルダ以下のみ軽量化する場合は、`PREFIX`を指定してください。

# スクリプトのみで既存のオブジェクトを軽量化するには

この方法は手軽ですが、進捗や結果がわかりにくいためオブジェクトの数が比較的少ない場合(1万件未満など)にお勧めします。

ファイル数が多い場合は次項の`S3バッチオペレーション`を検討ください。

次の手順で既存のオブジェクトをLightFile Lambda関数により軽量化します。

```
# 対象バケットの一覧をinventory.txtに出力します。
./list.sh
# inventory.txtのオブジェクトに対してLambda関数を実行し、画像を軽量化します。
./batch.sh
# batch.logに出力された結果を可視化します。
./log.sh
```

# S3バッチオペレーションのために既存のオブジェクトのCSVファイルを作成するには

S3には、バケットのオブジェクトに対するバッチ処理を実行する機能`S3バッチオペレーション`があります。

`S3バッチオペレーション`の入力ファイルは通常、`S3インベントリ`により定期的に出力された一覧ファイルですが、次のスクリプトで作成することができます。

```
# オブジェクトの一覧をS3バッチオペレーション用のCSVファイルinventory.csvに出力します。
./csv.sh
```

`S3バッチオペレーション`による既存の画像ファイルの軽量化の手順は、弊社のWebサイトを参照ください。

# サンプル画像

`samples`ディレクトリには